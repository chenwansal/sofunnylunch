{"version":3,"file":"MenuDao.js","sourceRoot":"./src/","sources":["DB/Dao/Menu/MenuDao.ts"],"names":[],"mappings":";;;AAAA,yDAAsD;AAEtD,2BAAwD;AACxD,mDAAgD;AAChD,yDAAsD;AAEtD,MAAa,OAAO;IAKhB,gBAAgB,CAAC;IAEjB,IAAI;QACA,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,UAAU,EAAE,CAAC;QACjC,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,YAAY,EAAE,CAAC;IACzC,CAAC;IAED,YAAY;QAER,IAAI,IAAI,CAAC,SAAS,IAAI,IAAI,EAAE;YACxB,OAAO,IAAI,CAAC,SAAS,CAAC;SACzB;QAED,IAAI,IAAI,CAAC,OAAO,IAAI,IAAI,EAAE;YACtB,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,UAAU,EAAE,CAAC;SACpC;QAED,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,KAAK,CAAC,QAAQ,IAAI,uBAAU,CAAC,WAAW,EAAE,CAAC,CAAC;QACxF,OAAO,IAAI,CAAC,SAAS,CAAC;IAE1B,CAAC;IAED,OAAO,CAAC,IAAe;QAEnB,IAAI,IAAI,CAAC,OAAO,IAAI,IAAI,EAAE;YACtB,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;SAC3B;QAED,IAAI,GAAG,GAAG,uBAAU,CAAC,gBAAgB,EAAE,GAAG,IAAI,CAAC,QAAQ,CAAC;QACxD,IAAI,IAAI,GAAG,GAAG,GAAG,OAAO,CAAC;QACzB,yBAAW,CAAC,WAAW,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;IACxC,CAAC;IAED,UAAU;QAEN,IAAI,IAAI,CAAC,OAAO,IAAI,IAAI,EAAE;YACtB,OAAO,IAAI,CAAC,OAAO,CAAC;SACvB;QAED,IAAI,GAAG,GAAW,uBAAU,CAAC,gBAAgB,EAAE,CAAC;QAChD,IAAI,CAAC,eAAU,CAAC,GAAG,CAAC,EAAE;YAClB,OAAO,CAAC,GAAG,CAAC,QAAQ,GAAG,GAAG,CAAC,CAAC;YAC5B,OAAO,EAAE,CAAC;SACb;QACD,IAAI,KAAK,GAAa,gBAAW,CAAC,GAAG,CAAC,CAAC;QACvC,IAAI,OAAO,GAAgB,EAAE,CAAC;QAC9B,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC,IAAI,CAAC,EAAE;YACtC,IAAI,IAAI,GAAG,KAAK,CAAC,CAAC,CAAC,CAAC;YACpB,IAAI,IAAI,GAAG,GAAG,GAAG,GAAG,GAAG,IAAI,CAAC;YAC5B,IAAI,IAAI,GAAc,yBAAW,CAAC,gBAAgB,CAAY,IAAI,CAAC,CAAC;YACpE,IAAI,IAAI,EAAE;gBACN,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;aACtB;iBAAM;gBACH,OAAO,CAAC,GAAG,CAAC,QAAQ,GAAG,IAAI,CAAC,CAAC;aAChC;SACJ;QAED,IAAI,OAAO,CAAC,MAAM,IAAI,CAAC,EAAE;YACrB,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;SACtB;QACD,OAAO,OAAO,CAAC;IACnB,CAAC;CAEJ;AApED,0BAoEC","sourcesContent":["import { DateHelper } from \"../../../Util/DateHelper\";\r\nimport { MenuTable } from \"../../Table/MenuTable\";\r\nimport { readdirSync, mkdirSync, existsSync } from \"fs\";\r\nimport { JsonVisitor } from \"../../JsonVisitor\";\r\nimport { PathHelper } from \"../../../Util/PathHelper\";\r\n\r\nexport class MenuDao {\r\n\r\n    allMenu: MenuTable[];\r\n    todayMenu: MenuTable;\r\n\r\n    constructor() { }\r\n\r\n    Init(): void {\r\n        this.allMenu = this.GetAllMenu();\r\n        this.todayMenu = this.GetTodayMenu();\r\n    }\r\n\r\n    GetTodayMenu(): MenuTable {\r\n\r\n        if (this.todayMenu != null) {\r\n            return this.todayMenu;\r\n        }\r\n\r\n        if (this.allMenu == null) {\r\n            this.allMenu = this.GetAllMenu();\r\n        }\r\n\r\n        this.todayMenu = this.allMenu.find(value => value.yyyymmdd == DateHelper.GetYYYYMMDD());\r\n        return this.todayMenu;\r\n\r\n    }\r\n\r\n    AddMenu(menu: MenuTable): void {\r\n\r\n        if (this.allMenu != null) {\r\n            this.allMenu.push(menu);\r\n        }\r\n\r\n        let dir = PathHelper.GetJsonDBMenuDir() + menu.yyyymmdd;\r\n        let path = dir + \".json\";\r\n        JsonVisitor.WriteToFile(path, menu);\r\n    }\r\n\r\n    GetAllMenu(): MenuTable[] {\r\n\r\n        if (this.allMenu != null) {\r\n            return this.allMenu;\r\n        }\r\n\r\n        let dir: string = PathHelper.GetJsonDBMenuDir();\r\n        if (!existsSync(dir)) {\r\n            console.log(\"不存在目录:\" + dir);\r\n            return [];\r\n        }\r\n        let files: string[] = readdirSync(dir);\r\n        let menuArr: MenuTable[] = [];\r\n        for (let i = 0; i < files.length; i += 1) {\r\n            let file = files[i];\r\n            let path = dir + \"/\" + file;\r\n            let menu: MenuTable = JsonVisitor.ReadJsonFromFile<MenuTable>(path);\r\n            if (menu) {\r\n                menuArr.push(menu);\r\n            } else {\r\n                console.log(\"不存在文件:\" + path);\r\n            }\r\n        }\r\n\r\n        if (menuArr.length == 0) {\r\n            console.log(\"无菜单\");\r\n        }\r\n        return menuArr;\r\n    }\r\n\r\n}"]}